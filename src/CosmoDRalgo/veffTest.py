import pytest
import numpy as np
from xSM import *

def test_BM1():

    LO_potential = 2
    LO_parameters = 2
    mu3Bar = 1
    mu4D = 1
    mh2 = 100
    lambdaMix = 0.8
    lambdaS = 1
    g = 0.4
    gPrime = 0.6
    yt = 1
    mPhiSq = -15000
    mSSq = -8000
    lambdaPhi = 0.13
    gSSq = 1.48

    inputparams = [g,gPrime,yt,mPhiSq,mSSq,lambdaPhi,gSSq]
    testclass = xSM(mh2,lambdaMix,lambdaS,inputparams,mu3Bar,mu4D,LO_parameters,LO_potential)

    phi = np.linspace(1e-10,100,100)
    s = np.linspace(1e-10,100,100)

    Fields = np.array([[phi[i],s[i]] for i in range(len(phi))])

    res = testclass.Vtot(Fields,200)
    print(res)
    comp = [-2.99633552e+06, -2.99517835e+06, -2.99172497e+06, -2.98596880e+06,
            -2.97788127e+06, -2.96741598e+06, -2.95450991e+06, -2.93908411e+06,
            -2.92104421e+06, -2.90028090e+06, -2.87667036e+06, -2.85007475e+06,
            -2.82034259e+06, -2.78730926e+06, -2.75079737e+06, -2.71061721e+06,
            -2.66656713e+06, -2.61843389e+06, -2.56599304e+06, -2.50900916e+06,
            -2.44723621e+06, -2.38041768e+06, -2.30828688e+06, -2.23056701e+06,
            -2.14697134e+06, -2.05720330e+06, -1.96095651e+06, -1.85791482e+06,
            -1.74775232e+06, -1.63013332e+06, -1.50471232e+06, -1.37113398e+06,
            -1.22903309e+06, -1.07803461e+06, -9.17753725e+05, -7.47796029e+05,
            -5.67757944e+05, -3.77227464e+05, -1.75785574e+05,  3.69910857e+04,
            2.61525011e+05,  4.98226987e+05,  7.47471093e+05,  1.00952721e+06,
            1.28432217e+06,  1.56991949e+06,  1.94337347e+06,  2.33843612e+06,
            2.72006832e+06,  3.10727980e+06,  3.50512378e+06,  3.91618974e+06,
            4.34240304e+06,  4.97122479e+06,  5.62987458e+06,  6.22771072e+06,
            6.81499063e+06,  7.40432344e+06,  8.00157664e+06,  8.61024965e+06,
            9.23276028e+06,  9.87095313e+06,  1.05263385e+07,  1.12002190e+07,
            1.18937614e+07,  1.26080423e+07,  1.33440758e+07,  1.41028335e+07,
            1.48852579e+07,  1.56922717e+07,  1.65247853e+07,  1.73837019e+07,
            1.82699218e+07,  1.91843450e+07,  2.01278746e+07,  2.11014178e+07,
            2.21058883e+07,  2.31422073e+07,  2.42113045e+07,  2.53141192e+07,
            2.64516010e+07,  2.76247102e+07,  2.88344190e+07,  3.00817112e+07,
            3.13675831e+07,  3.26930438e+07,  3.40591153e+07,  3.54668329e+07,
            3.69172456e+07,  3.84114160e+07,  3.99504208e+07,  4.15353507e+07,
            4.31673106e+07,  4.48474201e+07,  4.65768130e+07,  4.83566380e+07,
            5.01880583e+07,  5.20722522e+07,  5.40104127e+07,  5.60037480e+07]

    np.testing.assert_allclose(res, comp, rtol=1e-4)